var Globals=(function(){function a(){}a.initEnv=function(){this.env=nunjucks.configure({});this.env.addFilter("toFixed",function(b,c){return parseFloat(b).toFixed(c||2)});this.env.addFilter("cut",function(c,b){return c.substring(0,b||8)})};return a}());var Templates=(function(){function a(){}a.loadTemplates=function(){var b=true;this.testList=Globals.env.getTemplate("templates/test-list.njk",b);this.lineTooltip=Globals.env.getTemplate("templates/line-tooltip.njk",b);this.barTooltip=Globals.env.getTemplate("templates/bar-tooltip.njk",b);this.chart=Globals.env.getTemplate("templates/chart.njk",b);this.emptyResults=Globals.env.getTemplate("templates/empty-results.njk",b)};return a}());$(document).ready(function(){Globals.initEnv();Templates.loadTemplates();var b=false;$(document).keydown(function(c){if(c.which==17){b=true}});$(document).keyup(function(c){b=false});var a=window.cihpc.flaskApiUrl+"/"+window.cihpc.projectName;$.ajax({url:a+"/config",success:function(d){document.title=d.name;var f=function(l){if(b){return false}var n=null,i=null;for(var m=0,k=this.points;m<k.length;m++){var j=k[m];if(!n){var h=j.point.index;n=j.series.options.commits[h];i=j.point.name}}return Templates.lineTooltip.render({commit:n,date:i,points:this.points})};var g=function(i){if(b){return false}var n=[];var p="";for(var k=0,m=this.points;k<m.length;k++){var j=m[k];var l=j.point.index;var o=j.series.options.data[l].path;var h=j.series.options.data[l].name;break}return Templates.barTooltip.render({path:o.split("/").join("<br />"),name:h,points:this.points})};var e=function(h,i){$.ajax({url:a+"/case-view-detail/"+(h.join(","))+"",success:function(j){j.xAxis["labels"]={formatter:function(){return this.value.substring(0,24)}};j.tooltip.formatter=function(l){if(b){return false}var q=[];var s="";for(var n=0,p=this.points;n<p.length;n++){var m=p[n];var o=m.point.index;var r=m.series.options.data[o].path;var k=m.series.options.data[o].name;break}return Templates.barTooltip.render({path:r.split("/").join("<br />"),name:k,points:this.points})};$("#"+i).parent().removeClass("full-width");$("#"+i+"-detail").parent().removeClass("hidden");$("#"+i).highcharts().setSize(undefined,undefined);Highcharts.chart(i+"-detail",j)}})};var c=function(h,k,j){if(j){var i="mdl-button--raised";$(".testItem").removeClass(i);$(j).addClass(i)}$("#chartsHolder").empty();$.ajax({url:a+"/case-view/"+h+"/"+k+"/uniform=1,failed=0,smooth=0,separate=1,groupby=foo",success:function(o){$("#chartTitle").html(h+" / "+k);if(!Array.isArray(o)){$("#warning-msg .fs-inner-container").html(Templates.emptyResults.render(o));$("#warning-msg").removeClass("hidden");$("#page-content").addClass("hidden");return}$("#warning-msg").addClass("hidden");$("#page-content").removeClass("hidden");for(var n in o){var m=o[n].size;var l=o[n].data;var p="chart-"+(Number(n)+1);$("#chartsHolder").append(Templates.chart.render({testName:h,caseName:k,id:p}));l.xAxis.labels={useHTML:true,formatter:function(){var r=this.axis.series[0].options.commits[this.pos];var q=d["git-url"]+"/commit/"+r;return'<a href="'+q+'" target="_blank">'+this.value+"</a>"},events:{click:function(){}}};for(var n in l.series){if(!l.series[n].point){continue}l.series[n].point.events={select:function(r){var s=this.series.chart.renderTo.getAttribute("id");var x=$("#"+s).highcharts();var z=x.getSelectedPoints();z.push(this);var t=[];for(var u=0,y=z;u<y.length;u++){var A=y[u];var w=A.index;var v=A.series.userOptions.commits[w];var q=A.series.userOptions.uuids[w];t.push(q)}e(t,s)}}}l.tooltip.formatter=f;Highcharts.chart(p,l)}}})};$("#testsRendered").html(Templates.testList.render({title:d.name,tests:d.tests}));window.showChart=c;window.showChartDetail=e;c("*","*",$(".testItem")[0])}})});